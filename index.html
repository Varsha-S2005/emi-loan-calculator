<!DOCTYPE html>
<html>
<head>
    <title>Loan EMI Calculator</title>
    <script>
        async function calculateEMI() {
            const principal = document.getElementById("principal").value;
            const rate = document.getElementById("rate").value;
            const time = document.getElementById("time").value;

            const data = { principal: principal, rate: rate, time: time };
            try {
                const response = await fetch('/calculate_emi', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (response.ok) {
                    document.getElementById("emi").innerText = "EMI: " + result.emi;
                    const schedule = result.schedule;
                    const table = document.getElementById("schedule");
                    table.innerHTML = `
                        <tr>
                            <th>Month</th>
                            <th>Principal</th>
                            <th>Interest</th>
                            <th>EMI</th>
                            <th>Balance</th>
                        </tr>`;
                    
                    schedule.forEach(item => {
                        const row = table.insertRow();
                        row.insertCell().innerText = item.month;
                        row.insertCell().innerText = item.principal_payment;
                        row.insertCell().innerText = item.interest_payment;
                        row.insertCell().innerText = item.emi;
                        row.insertCell().innerText = item.balance;
                    });
                } else {
                    document.getElementById("emi").innerText = "Error calculating EMI: " + result.error;
                }
            } catch (error) {
                document.getElementById("emi").innerText = "Error: " + error.message;
            }
        }
    </script>
</head>
<body>
    <h1>Loan EMI Calculator</h1>
    <input type="number" id="principal" placeholder="Principal" step="0.01">
    <input type="number" id="rate" placeholder="Rate (%)" step="0.01">
    <input type="number" id="time" placeholder="Time (years)" step="0.01">
    <button onclick="calculateEMI()">Calculate EMI</button>
    <p id="emi"></p>
    <table id="schedule" border="1"></table>
</body>
</html>
